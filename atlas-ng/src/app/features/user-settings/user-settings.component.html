<div class="settings-container">
  <div class="page-header">
    <div class="page-header__title">
      <i class="fas fa-cog"></i>
      <h1>User Settings</h1>
    </div>
    <div class="page-header__actions">
      <button mat-button (click)="resetSettings()">
        <i class="fas fa-undo"></i>
        Reset to Defaults
      </button>
      <button mat-raised-button color="primary" (click)="saveSettings()" [disabled]="!hasChanges()">
        <i class="fas fa-save"></i>
        Save Changes
      </button>
    </div>
  </div>

  @if (loading()) {
    <div class="loading-container">
      <mat-spinner diameter="48"></mat-spinner>
      <p>Loading settings...</p>
    </div>
  } @else {
    <div class="settings-layout">
      <!-- Settings Panels -->
      <div class="settings-main">
        @for (section of settingSections; track section.name) {
          <mat-card class="settings-section">
            <mat-card-header>
              <mat-card-title>
                <i [class]="section.icon"></i>
                {{ section.name }}
              </mat-card-title>
              <mat-card-subtitle>{{ section.description }}</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              @for (setting of section.settings; track setting.key) {
                <div class="setting-item">
                  <div class="setting-info">
                    <span class="setting-label">{{ setting.label }}</span>
                    <span class="setting-description">{{ setting.description }}</span>
                  </div>
                  <div class="setting-control">
                    @switch (setting.type) {
                      @case ('toggle') {
                        <mat-slide-toggle
                          [(ngModel)]="setting.value"
                          (change)="onSettingChange()"
                          color="primary"
                        ></mat-slide-toggle>
                      }
                      @case ('select') {
                        <mat-form-field appearance="outline">
                          <mat-select [(ngModel)]="setting.value" (selectionChange)="onSettingChange()">
                            @for (option of setting.options; track option.value) {
                              <mat-option [value]="option.value">{{ option.label }}</mat-option>
                            }
                          </mat-select>
                        </mat-form-field>
                      }
                      @case ('number') {
                        <mat-form-field appearance="outline">
                          <input
                            matInput
                            type="number"
                            [(ngModel)]="setting.value"
                            (input)="onSettingChange()"
                          />
                        </mat-form-field>
                      }
                      @case ('text') {
                        <mat-form-field appearance="outline">
                          <input
                            matInput
                            [(ngModel)]="setting.value"
                            (input)="onSettingChange()"
                          />
                        </mat-form-field>
                      }
                    }
                  </div>
                </div>
                @if (!$last) {
                  <mat-divider></mat-divider>
                }
              }
            </mat-card-content>
          </mat-card>
        }
      </div>

      <!-- Sidebar -->
      <div class="settings-sidebar">
        <!-- Import/Export Card -->
        <mat-card class="actions-card">
          <mat-card-header>
            <mat-card-title>
              <i class="fas fa-file-export"></i>
              Import / Export
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="action-buttons">
              <button mat-stroked-button (click)="exportSettings()">
                <i class="fas fa-download"></i>
                Export Settings
              </button>
              <button mat-stroked-button (click)="importSettings()">
                <i class="fas fa-upload"></i>
                Import Settings
              </button>
            </div>
            <p class="action-hint">
              Export your settings to a file for backup or to transfer to another device.
            </p>
          </mat-card-content>
        </mat-card>

        <!-- Keyboard Shortcuts Card -->
        <mat-card class="shortcuts-card">
          <mat-card-header>
            <mat-card-title>
              <i class="fas fa-keyboard"></i>
              Keyboard Shortcuts
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="shortcuts-list">
              <div class="shortcut-item">
                <span class="shortcut-keys">
                  <kbd>Ctrl</kbd> + <kbd>K</kbd>
                </span>
                <span class="shortcut-action">Quick Search</span>
              </div>
              <div class="shortcut-item">
                <span class="shortcut-keys">
                  <kbd>Ctrl</kbd> + <kbd>S</kbd>
                </span>
                <span class="shortcut-action">Save</span>
              </div>
              <div class="shortcut-item">
                <span class="shortcut-keys">
                  <kbd>Ctrl</kbd> + <kbd>N</kbd>
                </span>
                <span class="shortcut-action">New Item</span>
              </div>
              <div class="shortcut-item">
                <span class="shortcut-keys">
                  <kbd>Esc</kbd>
                </span>
                <span class="shortcut-action">Close Dialog</span>
              </div>
              <div class="shortcut-item">
                <span class="shortcut-keys">
                  <kbd>?</kbd>
                </span>
                <span class="shortcut-action">Show Shortcuts</span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Quick Links Card -->
        <mat-card class="links-card">
          <mat-card-header>
            <mat-card-title>
              <i class="fas fa-link"></i>
              Related
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="links-list">
              <a mat-stroked-button routerLink="/user-profile">
                <i class="fas fa-user"></i>
                My Profile
              </a>
              <a mat-stroked-button routerLink="/configure">
                <i class="fas fa-cogs"></i>
                System Configuration
              </a>
              <a mat-stroked-button routerLink="/feedback">
                <i class="fas fa-comment"></i>
                Send Feedback
              </a>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  }
</div>
