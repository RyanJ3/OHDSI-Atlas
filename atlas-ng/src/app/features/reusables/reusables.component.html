<div class="reusables-container">
  <div class="page-header">
    <div class="page-header__title">
      <i class="fas fa-recycle"></i>
      <h1>Reusables</h1>
    </div>
    <div class="page-header__subtitle">
      Browse and use shared cohorts, concept sets, and analysis templates
    </div>
  </div>

  @if (loading()) {
    <div class="loading-container">
      <mat-spinner diameter="48"></mat-spinner>
      <p>Loading reusables...</p>
    </div>
  } @else {
    <mat-card>
      <mat-card-content>
        <div class="toolbar">
          <mat-form-field appearance="outline" class="search-field">
            <mat-label>Search reusables</mat-label>
            <input
              matInput
              [(ngModel)]="searchFilter"
              (ngModelChange)="applyFilters()"
              placeholder="Search by name or description..."
            />
            <mat-icon matPrefix>search</mat-icon>
          </mat-form-field>
        </div>

        <mat-tab-group (selectedIndexChange)="onTabChange($event)">
          <mat-tab label="All ({{ reusables().length }})"></mat-tab>
          <mat-tab label="Cohorts"></mat-tab>
          <mat-tab label="Concept Sets"></mat-tab>
          <mat-tab label="Analyses"></mat-tab>
        </mat-tab-group>

        @if (filteredReusables().length > 0) {
          <table mat-table [dataSource]="filteredReusables()" class="reusables-table">
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>Name</th>
              <td mat-cell *matCellDef="let item">
                <div class="name-cell">
                  <i [class]="getTypeIcon(item.type)"></i>
                  <div class="name-info">
                    <span class="name">{{ item.name }}</span>
                    <span class="description">{{ item.description }}</span>
                  </div>
                </div>
              </td>
            </ng-container>

            <ng-container matColumnDef="type">
              <th mat-header-cell *matHeaderCellDef>Type</th>
              <td mat-cell *matCellDef="let item">
                <mat-chip class="type-chip">{{ item.type }}</mat-chip>
              </td>
            </ng-container>

            <ng-container matColumnDef="usageCount">
              <th mat-header-cell *matHeaderCellDef>Usage</th>
              <td mat-cell *matCellDef="let item">
                <span class="usage-count">{{ item.usageCount }} uses</span>
              </td>
            </ng-container>

            <ng-container matColumnDef="modifiedDate">
              <th mat-header-cell *matHeaderCellDef>Modified</th>
              <td mat-cell *matCellDef="let item">{{ item.modifiedDate }}</td>
            </ng-container>

            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Actions</th>
              <td mat-cell *matCellDef="let item">
                <button mat-icon-button matTooltip="Use" (click)="useReusable(item)">
                  <i class="fas fa-plus-circle"></i>
                </button>
                <button mat-icon-button matTooltip="View" (click)="viewReusable(item)">
                  <i class="fas fa-eye"></i>
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
          </table>
        } @else {
          <div class="empty-state">
            <i class="fas fa-inbox"></i>
            <p>No reusables found</p>
          </div>
        }
      </mat-card-content>
    </mat-card>
  }
</div>
